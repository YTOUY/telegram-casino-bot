# Настройка мини-аппа на Netlify

## Текущий статус

Мини-апп развернут на Netlify: **https://arbuzcas.netlify.app**

## ⚠️ ВАЖНО: Настройка API сервера

Мини-апп требует подключения к API серверу бота. API сервер запускается на порту **8080** (см. `main.py`).

### Проблема

Сейчас `API_BASE` установлен как `/api` (относительный путь), что **НЕ РАБОТАЕТ** на Netlify, так как API сервер находится на другом сервере.

### Решение

Нужно указать **полный URL** вашего API сервера в файле `app.js`:

1. Откройте файл `mini_app/app.js`
2. Найдите строку с `API_BASE`
3. Замените на полный URL вашего API сервера:

```javascript
// Для продакшена на Netlify
if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
    // ЗАМЕНИТЕ НА ВАШ РЕАЛЬНЫЙ URL API СЕРВЕРА!
    API_BASE = 'https://your-server.com:8080/api';
    // Или если используете прокси (nginx):
    // API_BASE = 'https://api.your-domain.com/api';
}
```

### Варианты настройки API сервера:

#### Вариант 1: Прямое подключение (если сервер имеет публичный IP)
```javascript
API_BASE = 'https://your-server-ip:8080/api';
```

#### Вариант 2: Через домен с прокси (рекомендуется)
Настройте nginx или другой прокси для перенаправления запросов:
```javascript
API_BASE = 'https://api.your-domain.com/api';
```

#### Вариант 3: Через ngrok (для тестирования)
```javascript
API_BASE = 'https://your-ngrok-url.ngrok.io/api';
```

### Проверка работы API

После настройки проверьте, что API доступен:
- Откройте в браузере: `https://your-api-url/api/user` (должна быть ошибка авторизации, но не 404)
- Проверьте консоль браузера в мини-аппе на наличие ошибок подключения

## Пути к изображениям

Изображения подарков находятся в папке `nft/png/` и должны быть доступны по пути:
- `nft/png/gift-name.png`

Убедитесь, что папка `nft/` скопирована в `mini_app/` перед развертыванием на Netlify.

## Структура файлов на Netlify

```
mini_app/              # Публикуется на Netlify
├── index.html
├── styles.css
├── app.js
├── netlify.toml
├── _headers
├── nft/               # Подарки
│   ├── png/           # PNG изображения
│   └── tgs/           # TGS стикеры
└── stickers/          # Стикеры игр
```

## После настройки

1. Обновите `API_BASE` в `app.js`
2. Перезагрузите сайт на Netlify (или сделайте новый деплой)
3. Проверьте работу мини-аппа в Telegram
4. Проверьте консоль браузера на наличие ошибок

## Отладка

Если мини-апп не работает:
1. Откройте консоль браузера (F12)
2. Проверьте ошибки подключения к API
3. Убедитесь, что API сервер запущен и доступен
4. Проверьте CORS настройки на API сервере (должны быть разрешены запросы с Netlify)

